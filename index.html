<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Travesura Realizada</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Montserrat:wght@400;600&display=swap');

        :root {
            --gold: #d4af37;
            --spell-blue: #00d4ff;
            --dark: #050505;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: #000;
            font-family: 'Montserrat', sans-serif;
            color: var(--gold);
        }

        /* --- VIDEO DE FONDO Y VELAS --- */
        #video-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0.3; z-index: -1;
        }

        #candles-container {
            position: fixed; width: 100%; height: 100%; z-index: 0;
            pointer-events: none;
        }

        .candle {
            position: absolute; width: 4px; height: 30px;
            background: #fff; border-radius: 2px;
            box-shadow: 0 0 10px #fff, 0 -5px 15px orange;
            animation: flicker 2s infinite alternate, floatUp 15s linear infinite;
        }
        @keyframes flicker { 0% { opacity: 0.8; } 100% { opacity: 1; } }
        @keyframes floatUp { from { transform: translateY(110vh); } to { transform: translateY(-20vh); } }

        /* --- DESTELLO EXPELLIARMUS --- */
        #spell-flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; box-shadow: inset 0 0 100px var(--spell-blue);
            z-index: 100; opacity: 0; pointer-events: none;
        }
        .flash-anim { animation: expelliarmus 0.5s ease-out; }
        @keyframes expelliarmus {
            0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; }
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        #interface {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; position: relative; z-index: 10;
        }

        #magic-card {
            background: rgba(0, 0, 0, 0.75);
            border: 2px solid var(--gold);
            padding: 40px 20px; border-radius: 15px;
            width: 85%; max-width: 450px; text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.2);
        }

        h1 { font-family: 'Cinzel Decorative', serif; font-size: 1.8rem; margin-bottom: 5px; }
        .separator { height: 1px; width: 70%; background: var(--gold); margin: 15px auto; opacity: 0.5; }

        input {
            background: transparent; border: none; border-bottom: 2px solid var(--gold);
            color: #fff; font-size: 1.2rem; text-align: center; width: 90%;
            margin: 25px 0; outline: none; padding: 10px;
        }

        .btn {
            background: var(--gold); color: #000; border: none;
            padding: 15px 30px; font-family: 'Cinzel Decorative', serif;
            font-weight: bold; border-radius: 50px; cursor: pointer;
            width: 100%; transition: 0.3s;
        }

        .hidden { display: none !important; }

        /* Estilo para los di√°logos del bot√≥n NO */
        #no-btn { background: transparent; border: 1px solid #444; color: #666; margin-top: 10px; }
    </style>
</head>
<body>

<div id="spell-flash"></div>

<video id="video-bg" autoplay muted loop playsinline>
    <source src="https://assets.mixkit.co/videos/preview/mixkit-starry-night-sky-over-a-calm-lake-4375-large.mp4" type="video/mp4">
</video>

<div id="candles-container"></div>

<audio id="audio-hp" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" type="audio/mpeg">
</audio>

<div id="interface">
    <div id="magic-card">
        <div id="screen-1">
            <h1>"Travesura Realizada"</h1>
            <div class="separator"></div>
            <p style="font-style: italic;">Juro solemnemente que mis intenciones no son buenas...</p>
            <br>
            <button class="btn" onclick="iniciar()">Revelar Mapa</button>
        </div>

        <div id="screen-2" class="hidden">
            <h2 id="q-title" style="font-family: 'Cinzel Decorative';">Hechizo de Apertura</h2>
            <p id="q-text" style="font-size: 0.9rem; opacity: 0.8;"></p>
            <input type="text" id="ans-input" placeholder="Tu respuesta..." autocomplete="off">
            <button class="btn" onclick="validar()">Lanzar Hechizo</button>
            <p id="error-msg" style="color: #ff4444; font-size: 0.8rem; margin-top: 15px; min-height: 20px;"></p>
        </div>

        <div id="screen-3" class="hidden">
            <h1>‚ú® Propuesta M√°gica ‚ú®</h1>
            <div class="separator"></div>
            <p>Has completado el mapa del merodeador.</p>
            <h2 style="font-size: 1.4rem;">¬øQuieres ser mi San Valent√≠n?</h2>
            <button class="btn" style="background: #00ff41; color: #000;" onclick="finalizar()">¬°S√ç, ACEPTO!</button>
            <button class="btn" id="no-btn" onclick="piensalo()">No</button>
        </div>

        <div id="screen-4" class="hidden">
            <h1 style="color: var(--gold); font-size: 2.2rem;">‚ö°</h1>
            <h2>Travesura Realizada</h2>
            <p>Nos vemos en el Gran Comedor.</p>
        </div>
    </div>
</div>

<script>
    const data = {
        qs: [
            { q: "¬øEn qu√© fecha (DD/MM/AAAA) comenz√≥ nuestra historia?", a: "24/04/2024" },
            { q: "¬øCu√°l fue la primera foto nuestra que te gust√≥?", a: "espejo" },
            { q: "¬øA qu√© lugar viajamos juntos por primera vez?", a: "ayacucho" }
        ],
        msgs: ["¬øSegura? El Mapa no miente... ü§®", "¬°Por Merl√≠n! Esa no es. ‚ú®", "¬°Pi√©nsalo bien! ü™Ñ"],
        noTexts: ["¬øSegura?", "Pi√©nsalo bien...", "¬øDe verdad?", "¬øMe est√°s hechizando?"]
    };

    let step = 0;
    let noIdx = 0;

    // Crear velas flotantes
    const container = document.getElementById('candles-container');
    for (let i = 0; i < 25; i++) {
        const c = document.createElement('div');
        c.className = 'candle';
        c.style.left = Math.random() * 95 + 'vw';
        c.style.animationDelay = Math.random() * 10 + 's';
        c.style.opacity = Math.random();
        container.appendChild(c);
    }

    function iniciar() {
        document.getElementById('audio-hp').play();
        document.getElementById('screen-1').classList.add('hidden');
        document.getElementById('screen-2').classList.remove('hidden');
        updateQ();
    }

    function updateQ() {
        document.getElementById('q-text').innerText = data.qs[step].q;
        document.getElementById('ans-input').value = "";
        document.getElementById('error-msg').innerText = "";
    }

    function validar() {
        const val = document.getElementById('ans-input').value.toLowerCase().trim();
        const correct = data.qs[step].a.toLowerCase();
        
        if ((step !== 1 && val === correct) || (step === 1 && val.includes("espejo"))) {
            // EFECTO EXPELLIARMUS
            const flash = document.getElementById('spell-flash');
            flash.classList.add('flash-anim');
            setTimeout(() => flash.classList.remove('flash-anim'), 500);

            step++;
            if (step < data.qs.length) updateQ();
            else {
                document.getElementById('screen-2').classList.add('hidden');
                document.getElementById('screen-3').classList.remove('hidden');
            }
        } else {
            document.getElementById('error-msg').innerText = data.msgs[Math.floor(Math.random()*data.msgs.length)];
        }
    }

    function piensalo() {
        document.getElementById('no-btn').innerText = data.noTexts[noIdx % data.noTexts.length];
        noIdx++;
    }

    function finalizar() {
        document.getElementById('screen-3').classList.add('hidden');
        document.getElementById('screen-4').classList.remove('hidden');
        setInterval(lanzarMagia, 150);
    }

    function lanzarMagia() {
        const m = document.createElement('div');
        m.style.position = 'fixed';
        m.style.left = Math.random() * 100 + 'vw';
        m.style.top = '-20px';
        m.style.fontSize = '20px';
        m.innerText = ["‚ö°", "üåª", "‚ù§Ô∏è", "‚ú®"][Math.floor(Math.random()*4)];
        m.style.animation = `fall ${Math.random() * 2 + 2}s linear forwards`;
        document.body.appendChild(m);
        setTimeout(() => m.remove(), 4000);
    }
</script>

<style>
    @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
</style>

</body>
</html>
